#include "lcd_init.h"

static uint8_t flipState = 0x00; // мой 0A Паши 03

//  LCD
void FSMC_LcdWriteCmd ( uint16_t val )
{
	// Write 16-bit Index (then Read Reg)
	__LCD->LCD_REG = val;
} // FSMC_LcdWriteCmd

//  LCD
void FSMC_LcdWriteData( uint16_t val )
{
	// Write 16-bit Reg
	__LCD->LCD_RAM = val;
} // FSMC_LcdWriteData

void LCD_Delay(uint16_t time)
{
	 //osDelay(time);
	 HAL_Delay(time);
}


// *****************************************************************************

void SSD1963_Init(void)
{
	 // ????????????? FSMC
     //FSMC_Init ( );

     // Soft reset
     FSMC_LcdWriteCmd ( 0x01 );     // software reset
     FSMC_LcdWriteCmd ( 0x01 );     // software reset
     FSMC_LcdWriteCmd ( 0x01 );     // software reset
     LCD_Delay ( 120 ); //????????

     FSMC_LcdWriteCmd ( 0xE2 );                         // PLL multiplier, set PLL clock to 120M
     FSMC_LcdWriteData ( 0x23 );  //????????? PLL(M)    // N=0x36 for 6.5M, 0x23 for 10M crystal
     FSMC_LcdWriteData ( 0x02 );  //???????? PLL(N)
     FSMC_LcdWriteData ( 0x04 );  //??????? ?? ????????????? ?????????? ? ???????? PLL
     FSMC_LcdWriteCmd ( 0xE0 );  //?????? PLL
     FSMC_LcdWriteData ( 0x01 ); // PLL ???????? ? ???????????? ?????????? ????????? ??? ?????????
     LCD_Delay(1); //???????? ??????? PLL

     FSMC_LcdWriteCmd ( 0xE0 );  //???????????? ??????? ? ??????????? ?????????? ?? PLL
     FSMC_LcdWriteData ( 0x03 );
     FSMC_LcdWriteCmd ( 0x01 );   // software reset
     LCD_Delay(120);// ? ????? ????? ??????? 120 ?????? 5

     FSMC_LcdWriteCmd ( 0xE6 );     //????????? ??????? ???????????? ???????
                                    // PLL setting for PCLK, depends on resolution
     FSMC_LcdWriteData ( 0x04 );    //5,3??? = PLL freq x ((??????? ???????????? + 1) / 2^20)
     FSMC_LcdWriteData ( 0xFF );    //??? 100??? ?????? ???? 0?00D916
     FSMC_LcdWriteData ( 0xFF );

     FSMC_LcdWriteCmd ( 0xB0 );                         // Set LCD mode
     FSMC_LcdWriteData ( 0x27 ); //10 - ??? 18bit 27 - ???? 24bit
     FSMC_LcdWriteData ( 0x00 ); // 0x00 00 ? 20 - TFT ?????, 40 serial RGB ?????
     FSMC_LcdWriteData ( (HDP>>8) & 0xFF );  //?????????? ?? ???????????        // Set HDP
     FSMC_LcdWriteData ( HDP & 0xFF );
     FSMC_LcdWriteData ( (VDP>>8) & 0xFF );   //?????????? ?? ?????????       // Set VDP
     FSMC_LcdWriteData ( VDP & 0xFF );
     FSMC_LcdWriteData ( 0x00 ); //? ????? ???????? ????????? 0?2D ? ????? ?? ???? ?????? 36 ???????
     	 	 	 	 	 	 	 // 0010 1101 - G[5..3]= 101
     	 	 	 	 	 	 	 //				G[2..0] = 101 - BGR

     //?4 ? ?6 ??????? ?????????? ?? ??????????? ? ????????? (??? ???????)
     FSMC_LcdWriteCmd ( 0xB4 );                    // Set horizontal period
     FSMC_LcdWriteData ( (HT>>8)& 0xFF );          // Set HT
     FSMC_LcdWriteData ( HT & 0xFF );
     FSMC_LcdWriteData ( (HPS >> 8) & 0XFF );      // Set HPS
     FSMC_LcdWriteData ( HPS & 0xFF );
     FSMC_LcdWriteData ( HPW );                    // Set HPW
     FSMC_LcdWriteData ( (LPS>>8) & 0XFF );        // Set HPS
     FSMC_LcdWriteData ( LPS & 0XFF );
     FSMC_LcdWriteData ( 0x00 );

	FSMC_LcdWriteCmd ( 0xB6 );                    // Set vertical period
	FSMC_LcdWriteData ( (VT>>8) & 0xFF );         // Set VT
	FSMC_LcdWriteData ( VT & 0xFF );
	FSMC_LcdWriteData ( (VPS>>8) & 0xFF );        // Set VPS
	FSMC_LcdWriteData ( VPS & 0xFF );
	FSMC_LcdWriteData ( VPW );                    // Set VPW
	FSMC_LcdWriteData ( (FPS>>8) & 0xFF );        // Set FPS
	FSMC_LcdWriteData ( FPS & 0xFF );

 	// ?? ? ?8 ???????????? ?????? ????? SSD1963 ? ????????
     FSMC_LcdWriteCmd ( 0xBA );
     FSMC_LcdWriteData ( 0x0F );                         // GPIO[3:0] out 1
     FSMC_LcdWriteCmd ( 0xB8 );
     FSMC_LcdWriteData ( 0x07 );                         // 0x07 GPIO3=input, GPIO[2:0]=output
     FSMC_LcdWriteData ( 0x01 );                         // 0x01 GPIO0 normal

     FSMC_LcdWriteCmd ( 0x36 );                         // Set Address mode - rotation
     FSMC_LcdWriteData ( flipState );  // ??? 0 - flip vertical ??? 1 - flip horizontal

     FSMC_LcdWriteCmd ( 0xBC );                         // ????????? ??????? ? ??
     FSMC_LcdWriteData ( 0x40 );                         // ????????
     FSMC_LcdWriteData ( 0x90 );                         // ???????
     FSMC_LcdWriteData ( 0x40 );                         // ??????????? ?????
     FSMC_LcdWriteData ( 0x01 );                         // ???? ?????????(1- ??? ?????????, 0- ????)

     FSMC_LcdWriteCmd ( 0xF0 );                         // pixel data interface
     FSMC_LcdWriteData ( 0x03 );                         // 03h - RGB565

     LCD_Delay ( 5 );

     FSMC_LcdWriteCmd ( 0x29 );                         // display on

     FSMC_LcdWriteCmd ( 0xd0 );  //????????? ?????? ?????????? ????????      // Dynamic Bright Control
     FSMC_LcdWriteData ( 0x0d ); //????? ???????????????? - ???????????
	
}


//================================================================================
//
//================================================================================
